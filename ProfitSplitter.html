<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profit Splitter with PDF Export</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { background: #111; color: white; font-family: Arial, sans-serif; padding: 20px; }
    .button { padding: 10px 20px; background: #444; color: white; border: none; cursor: pointer; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #555; padding: 8px; text-align: center; }
    #pdfContent { background: white; color: black; padding: 30px; width: 800px; margin: auto; display: none; }
    #pdfContent img { max-height: 80px; }
    #reportHeader { display: flex; justify-content: space-between; align-items: center; }
    #reportTableContainer table { border: 1px solid #000; }
  </style>
</head>
<body>  <h1>Profit Splitter</h1>
  <label>Title: <input type="text" id="title" value="Operation Silverhaul"></label><br><br>
  <label>Total Profit: <input type="number" id="totalProfit" value="100000"></label><br><br>  <table id="outputTable">
    <thead>
      <tr>
        <th>Player</th>
        <th>Split Type</th>
        <th>Share</th>
        <th>Payout</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>AcePilot</td>
        <td>Flat</td>
        <td>20000</td>
        <td>20000</td>
      </tr>
      <tr>
        <td>MinerJoe</td>
        <td>Percent</td>
        <td>20%</td>
        <td>16000</td>
      </tr>
    </tbody>
  </table><button class="button" onclick="exportToPDF()">Export as PDF</button>

  <div id="pdfContent">
    <div id="reportHeader">
      <div>
        <img id="orgImage" src="org_logo.png" alt="Org Logo">
        <h2 id="orgName">Org Name</h2>
      </div>
      <div style="text-align: right;">
        <img id="userImage" src="user_avatar.png" alt="User Image" style="border-radius: 50%;">
        <h3 id="userName">User Name</h3>
      </div>
    </div>
    <hr />
    <h1 id="reportTitle"></h1>
    <p id="reportDate"></p>
    <p id="totalProfitSummary"></p>
    <div id="reportTableContainer"></div>
  </div>  <script>
    function generatePDFContent() {
      const title = document.getElementById("title").value || "Untitled Mission";
      const date = new Date().toLocaleString();
      const totalProfit = document.getElementById("totalProfit").value;

      document.getElementById("userName").innerText = localStorage.getItem("userName") || "Commander";
      document.getElementById("orgName").innerText = localStorage.getItem("orgName") || "Freelancer Co.";
      document.getElementById("userImage").src = localStorage.getItem("userImage") || "defaultUser.png";
      document.getElementById("orgImage").src = localStorage.getItem("orgImage") || "defaultOrg.png";

      document.getElementById("reportTitle").innerText = `Profit Split: ${title}`;
      document.getElementById("reportDate").innerText = `Date: ${date}`;
      document.getElementById("totalProfitSummary").innerText = `Total Profit: ${totalProfit}`;

      const tableClone = document.getElementById("outputTable").cloneNode(true);
      document.getElementById("reportTableContainer").innerHTML = "";
      document.getElementById("reportTableContainer").appendChild(tableClone);
    }

    async function exportToPDF() {
      generatePDFContent();
      const pdfElement = document.getElementById("pdfContent");
      pdfElement.style.display = "block";

      await html2canvas(pdfElement, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jspdf.jsPDF("p", "pt", "a4");
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const imgProps = pdf.getImageProperties(imgData);
        const imgHeight = imgProps.height * (pageWidth / imgProps.width);

        let position = 0;
        if (imgHeight < pageHeight) {
          pdf.addImage(imgData, 'PNG', 0, 0, pageWidth, imgHeight);
        } else {
          let remainingHeight = imgHeight;
          let pageOffset = 0;
          while (remainingHeight > 0) {
            pdf.addImage(imgData, 'PNG', 0, pageOffset, pageWidth, imgHeight);
            remainingHeight -= pageHeight;
            if (remainingHeight > 0) pdf.addPage();
            pageOffset -= pageHeight;
          }
        }

        const filename = `ProfitSplit_${Date.now()}.pdf`;
        pdf.save(filename);

        storeReport(filename);
      });

      pdfElement.style.display = "none";
    }

    function storeReport(filename) {
      const title = document.getElementById("title").value || "Untitled";
      const date = new Date().toLocaleString();
      const previous = JSON.parse(localStorage.getItem("previousReports") || "[]");
      previous.push({ title, filename, date });
      localStorage.setItem("previousReports", JSON.stringify(previous));
    }
  </script></body>
</html>