<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Yield2Sell</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: #fff;
      font-family: sans-serif;
      padding: 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1.5rem;
    }
    th, td {
      border: 1px solid #444;
      padding: 0.5rem;
      text-align: center;
    }
    input, select {
      width: 100%;
      padding: 0.25rem;
      font-size: 1rem;
    }
    .highlighted-text {
      font-weight: bold;
      color: #fff;
    }
    button {
      padding: 0.5rem 1rem;
      margin: 0.25rem;
      font-weight: bold;
      background-color: #333;
      color: white;
      border: 1px solid #666;
      cursor: pointer;
    }
    .total-display {
      font-size: 1.2em;
      font-weight: bold;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Yield2Sell Calculator</h1>
    <table id="priceTable">
      <thead>
        <tr>
          <th>Item</th>
          <th>Yield</th>
          <th>Location</th>
          <th>Price Per SCU (aUEC)</th>
          <th>Item Total</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="total-display" id="grandTotalDisplay">Total: 0 aUEC</div>

    <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
      <button onclick="copyToClipboard()">Copy to Clipboard</button>
      <button onclick="exportToTXT()">Export to TXT</button>
      <button onclick="exportToCSV()">Export to CSV</button>
    </div>
  </main>

  <script>
    const items = ["Quantanium", "Bexalite", "Taranite"];
    const locations = {
      "Quantanium": { "Area18": 450, "Lorville": 500 },
      "Bexalite": { "Area18": 800, "Lorville": 850 },
      "Taranite": { "Area18": 1000, "Lorville": 1050 }
    };

    function formatNum(num) {
      return Number(num).toLocaleString(undefined, { maximumFractionDigits: 0 });
    }

    function populateTable() {
      const tbody = document.getElementById("tableBody");

      items.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item}</td>
          <td><input type="number" min="0" /></td>
          <td>
            <select>
              ${Object.keys(locations[item]).map(loc => `<option value="${loc}">${loc}</option>`).join('')}
            </select>
          </td>
          <td class="priceCell"></td>
          <td class="rowTotal">0</td>
        `;

        const input = row.querySelector("input");
        const select = row.querySelector("select");
        const priceCell = row.querySelector(".priceCell");
        const rowTotal = row.querySelector(".rowTotal");

        function updateRow() {
          const location = select.value;
          const price = locations[item][location] || 0;
          priceCell.textContent = formatNum(price);

          const yieldAmount = parseFloat(input.value) || 0;
          const total = yieldAmount * price;
          rowTotal.textContent = formatNum(total);

          updateGrandTotal();
        }

        input.addEventListener("input", updateRow);
        select.addEventListener("change", updateRow);

        updateRow();
        tbody.appendChild(row);
      });
    }

    function updateGrandTotal() {
      let total = 0;
      document.querySelectorAll(".rowTotal").forEach(cell => {
        total += parseFloat(cell.textContent.replace(/,/g, "")) || 0;
      });
      document.getElementById("grandTotalDisplay").textContent = "Total: " + formatNum(total) + " aUEC";
    }

    function exportToTXT() {
      let txt = "Item | Yield | Location | Unit Price | Total\n";
      const rows = document.querySelectorAll("#priceTable tbody tr");
      let grandTotal = 0;

      rows.forEach(row => {
        const item = row.cells[0].textContent;
        const yieldVal = row.cells[1].querySelector("input").value || "0";
        const location = row.cells[2].querySelector("select").value;
        const price = row.cells[3].textContent;
        const total = row.cells[4].textContent;

        const parsedTotal = parseFloat(total.replace(/,/g, "")) || 0;
        txt += `${item} | ${yieldVal} | ${location} | ${price} | ${total}\n`;
        grandTotal += parsedTotal;
      });

      txt += `\nGrand Total: ${formatNum(grandTotal)} aUEC`;
      downloadFile(txt, `Yield2Sell_${timestamp()}.txt`);
    }

    function exportToCSV() {
      let csv = "Item,Yield,Location,Unit Price,Total\n";
      const rows = document.querySelectorAll("#priceTable tbody tr");
      let grandTotal = 0;

      rows.forEach(row => {
        const item = row.cells[0].textContent;
        const yieldVal = row.cells[1].querySelector("input").value || "0";
        const location = row.cells[2].querySelector("select").value;
        const price = row.cells[3].textContent.replace(/,/g, "");
        const total = row.cells[4].textContent.replace(/,/g, "");

        grandTotal += parseFloat(total) || 0;
        csv += `"${item}",${yieldVal},"${location}",${price},${total}\n`;
      });

      csv += `\nGrand Total,,,\,"${formatNum(grandTotal)}"`;
      downloadFile(csv, `Yield2Sell_${timestamp()}.csv`);
    }

    function copyToClipboard() {
      let text = "Item | Yield | Location | Unit Price | Total\n";
      const rows = document.querySelectorAll("#priceTable tbody tr");
      let grandTotal = 0;

      rows.forEach(row => {
        const item = row.cells[0].textContent;
        const yieldVal = row.cells[1].querySelector("input").value || "0";
        const location = row.cells[2].querySelector("select").value;
        const price = row.cells[3].textContent;
        const total = row.cells[4].textContent;

        const parsedTotal = parseFloat(total.replace(/,/g, "")) || 0;
        text += `${item} | ${yieldVal} | ${location} | ${price} | ${total}\n`;
        grandTotal += parsedTotal;
      });

      text += `\nGrand Total: ${formatNum(grandTotal)} aUEC`;

      navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
      }).catch(() => {
        alert("Failed to copy.");
      });
    }

    function downloadFile(content, filename) {
      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    function timestamp() {
      return new Date().toISOString().slice(0, 16).replace(/[:T]/g, "-");
    }

    populateTable();
  </script>
</body>
</html>
