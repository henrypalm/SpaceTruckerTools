<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile Setup</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem;
      background-color: #121212;
      color: #eee;
    }
    label {
      display: block;
      margin-top: 0.75rem;
    }
    input, textarea {
      width: 100%;
      max-width: 400px;
      padding: 0.4rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #222;
      color: #eee;
    }
    img {
      max-width: 150px;
      margin-top: 0.5rem;
      border-radius: 8px;
      border: 1px solid #444;
    }
    button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      background: #0078d7;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #005a9e;
    }
    .profile-view {
      margin-top: 2rem;
      border-top: 1px solid #444;
      padding-top: 1rem;
      max-width: 500px;
      background: #222;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Profile Setup</h1>

  <form id="profile-form">
    <label>
      Organization Name:
      <input type="text" id="orgname" name="orgname" placeholder="Your organization name" />
    </label>

    <label>
      Organization Image URL:
      <input type="url" id="orgimage" name="orgimage" placeholder="Image URL for organization" />
    </label>

    <label>
      User Image URL:
      <input type="url" id="userimage" name="userimage" placeholder="User image URL" />
    </label>

    <label>
      User Description:
      <textarea id="userdesc" name="userdesc" rows="4" placeholder="Describe yourself"></textarea>
    </label>

    <label>
      Additional Data (JSON format):
      <textarea id="otherdata" name="otherdata" rows="4" placeholder='e.g. {"role":"Leader","level":10}'></textarea>
    </label>

    <button type="button" id="save-btn">Save Profile</button>
    <button type="button" id="load-btn">Load Profile</button>
    <button type="button" id="clear-btn">Clear Profile</button>
  </form>

  <div class="profile-view" id="profile-view" style="display:none;">
    <h2>Current Profile</h2>
    <p><strong>Organization Name:</strong> <span id="view-orgname"></span></p>
    <p><strong>Organization Image:</strong><br/><img id="view-orgimage" alt="Org Image" /></p>
    <p><strong>User Image:</strong><br/><img id="view-userimage" alt="User Image" /></p>
    <p><strong>User Description:</strong> <span id="view-userdesc"></span></p>
    <p><strong>Additional Data:</strong></p>
    <pre id="view-otherdata" style="background:#111; padding:0.5rem; border-radius:4px;"></pre>
  </div>

  <script>
    const saveBtn = document.getElementById('save-btn');
    const loadBtn = document.getElementById('load-btn');
    const clearBtn = document.getElementById('clear-btn');

    const profileView = document.getElementById('profile-view');

    function setCookie(name, value, days) {
      const d = new Date();
      d.setTime(d.getTime() + (days*24*60*60*1000));
      const expires = "expires="+ d.toUTCString();
      document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/";
    }

    function getCookie(name) {
      const cname = name + "=";
      const decodedCookie = decodeURIComponent(document.cookie);
      const ca = decodedCookie.split(';');
      for(let i = 0; i < ca.length; i++) {
        let c = ca[i].trim();
        if (c.indexOf(cname) === 0) {
          return c.substring(cname.length, c.length);
        }
      }
      return "";
    }

    function showProfile(data) {
      if (!data) {
        profileView.style.display = 'none';
        return;
      }
      profileView.style.display = 'block';
      document.getElementById('view-orgname').textContent = data.orgname || '';
      const orgImg = document.getElementById('view-orgimage');
      if (data.orgimage) {
        orgImg.src = data.orgimage;
        orgImg.style.display = 'inline-block';
      } else {
        orgImg.style.display = 'none';
      }
      const userImg = document.getElementById('view-userimage');
      if (data.userimage) {
        userImg.src = data.userimage;
        userImg.style.display = 'inline-block';
      } else {
        userImg.style.display = 'none';
      }
      document.getElementById('view-userdesc').textContent = data.userdesc || '';
      if (data.otherdata) {
        try {
          const parsed = typeof data.otherdata === 'string' ? JSON.parse(data.otherdata) : data.otherdata;
          document.getElementById('view-otherdata').textContent = JSON.stringify(parsed, null, 2);
        } catch {
          document.getElementById('view-otherdata').textContent = "Invalid JSON";
        }
      } else {
        document.getElementById('view-otherdata').textContent = "";
      }
    }

    saveBtn.addEventListener('click', () => {
      const orgname = document.getElementById('orgname').value.trim();
      const orgimage = document.getElementById('orgimage').value.trim();
      const userimage = document.getElementById('userimage').value.trim();
      const userdesc = document.getElementById('userdesc').value.trim();
      const otherdata = document.getElementById('otherdata').value.trim();

      // Validate otherdata JSON
      if (otherdata) {
        try {
          JSON.parse(otherdata);
        } catch (e) {
          alert("Additional Data must be valid JSON.");
          return;
        }
      }

      const profileData = {
        orgname,
        orgimage,
        userimage,
        userdesc,
        otherdata
      };

      setCookie('profileData', JSON.stringify(profileData), 365);
      alert("Profile saved to cookies!");
      showProfile(profileData);
    });

    loadBtn.addEventListener('click', () => {
      const saved = getCookie('profileData');
      if (!saved) {
        alert("No saved profile found.");
        return;
      }
      try {
        const data = JSON.parse(saved);
        // Populate form
        document.getElementById('orgname').value = data.orgname || '';
        document.getElementById('orgimage').value = data.orgimage || '';
        document.getElementById('userimage').value = data.userimage || '';
        document.getElementById('userdesc').value = data.userdesc || '';
        document.getElementById('otherdata').value = data.otherdata || '';
        showProfile(data);
      } catch {
        alert("Saved profile data is corrupted.");
      }
    });

    clearBtn.addEventListener('click', () => {
      setCookie('profileData', "", -1);
      document.getElementById('profile-form').reset();
      showProfile(null);
      alert("Profile cleared.");
    });

    // On page load, try to load existing profile automatically
    window.addEventListener('load', () => {
      const saved = getCookie('profileData');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          // Populate form and show profile
          document.getElementById('orgname').value = data.orgname || '';
          document.getElementById('orgimage').value = data.orgimage || '';
          document.getElementById('userimage').value = data.userimage || '';
          document.getElementById('userdesc').value = data.userdesc || '';
          document.getElementById('otherdata').value = data.otherdata || '';
          showProfile(data);
        } catch {
          // ignore errors
        }
      }
    });
  </script>
</body>
</html>