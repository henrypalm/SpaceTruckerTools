<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Manifest Overview</title>
<style>
  body {
    background-color: #111;
    color: white;
    font-family: Arial, sans-serif;
    padding: 2rem;
  }
  h1 {
    color: gold;
    text-align: center;
    margin-bottom: 1rem;
  }
  .list-container {
    max-width: 800px;
    margin: 0 auto;
  }
  .section-title {
    font-size: 1.5rem;
    margin-top: 2rem;
    margin-bottom: 0.5rem;
    border-bottom: 2px solid gold;
    padding-bottom: 0.25rem;
  }
  .order {
    background: #222;
    border: 1px solid #444;
    margin-bottom: 0.5rem;
    border-radius: 5px;
    overflow: hidden;
  }
  .order-header {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    cursor: pointer;
    background: #333;
  }
  .order-header:hover {
    background: #444;
  }
  .order-header span {
    font-weight: bold;
  }
  .manifest-table {
    width: 100%;
    border-collapse: collapse;
  }
  .manifest-table th, .manifest-table td {
    border: 1px solid #444;
    padding: 0.5rem;
    text-align: left;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>

<h1>Manifest Overview</h1>
<div class="list-container">
  <div>
    <div class="section-title">Active Orders</div>
    <div id="active-orders"></div>
  </div>
  <div>
    <div class="section-title">Completed Orders</div>
    <div id="completed-orders"></div>
  </div>
</div>

<script>
let activeOrders = JSON.parse(localStorage.getItem("activeOrders")) || [];
let completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
let expandedKeys = JSON.parse(localStorage.getItem("expandedKeys")) || [];

const orderElementMap = {};

function saveData() {
  localStorage.setItem("activeOrders", JSON.stringify(activeOrders));
  localStorage.setItem("completedOrders", JSON.stringify(completedOrders));
  localStorage.setItem("expandedKeys", JSON.stringify(expandedKeys));
}

function renderLists() {
  const activeContainer = document.getElementById("active-orders");
  const completedContainer = document.getElementById("completed-orders");
  activeContainer.innerHTML = "";
  completedContainer.innerHTML = "";
  // Clear map
  for (const key in orderElementMap) delete orderElementMap[key];

  activeOrders.forEach(order => {
    const element = createOrderElement(order);
    activeContainer.appendChild(element.container);
    orderElementMap[order.key] = element;
    // Set initial expanded/collapsed based on saved state
    if (expandedKeys.includes(order.key)) {
      element.tableSection.classList.remove("hidden");
      element.icon.textContent = "−";
    }
  });

  completedOrders.forEach(order => {
    const element = createOrderElement(order);
    completedContainer.appendChild(element.container);
    orderElementMap[order.key] = element;
    if (expandedKeys.includes(order.key)) {
      element.tableSection.classList.remove("hidden");
      element.icon.textContent = "−";
    }
  });
}

function createOrderElement(order) {
  const container = document.createElement("div");
  container.classList.add("order");

  const header = document.createElement("div");
  header.classList.add("order-header");
  const title = document.createElement("span");
  title.textContent = order.title;
  const icon = document.createElement("span");
  icon.textContent = "+";
  header.appendChild(title);
  header.appendChild(icon);

  const tableSection = document.createElement("div");
  tableSection.classList.add("hidden");

  const table = document.createElement("table");
  table.classList.add("manifest-table");
  const thead = document.createElement("thead");
  thead.innerHTML = "<tr><th>Commodity</th><th>Quantity</th><th>Value</th></tr>";
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  order.manifest.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${item.name}</td><td>${item.quantity}</td><td>${item.value}</td>`;
    tbody.appendChild(row);
  });
  table.appendChild(tbody);

  tableSection.appendChild(table);
  header.addEventListener("click", () => toggleManifest(order.key));

  container.appendChild(header);
  container.appendChild(tableSection);

  return { container, tableSection, icon };
}

function toggleManifest(key) {
  const node = orderElementMap[key];
  if (!node) return;

  const isHidden = node.tableSection.classList.contains("hidden");
  node.tableSection.classList.toggle("hidden");
  node.icon.textContent = isHidden ? "−" : "+";

  if (isHidden) {
    // was hidden, now shown
    if (!expandedKeys.includes(key)) expandedKeys.push(key);
  } else {
    // was shown, now hidden
    const idx = expandedKeys.indexOf(key);
    if (idx > -1) expandedKeys.splice(idx, 1);
  }
  saveData();
}

// Add some test data if nothing saved yet
if (activeOrders.length === 0 && completedOrders.length === 0) {
  activeOrders = [
    {
      key: "a1",
      title: "WO-1001",
      manifest: [
        { name: "Iron Ore", quantity: 50, value: 500 },
        { name: "Hydrogen Fuel", quantity: 20, value: 200 }
      ]
    }
  ];
  completedOrders = [
    {
      key: "c1",
      title: "WO-0901",
      manifest: [
        { name: "Gold", quantity: 10, value: 1000 }
      ]
    }
  ];
  saveData();
}

renderLists();
</script>

</body>
</html>
